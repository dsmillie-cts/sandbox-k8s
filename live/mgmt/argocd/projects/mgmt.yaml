apiVersion: argoproj.io/v1alpha1
kind: AppProject
metadata:
  name: mgmt
  namespace: argocd
spec:
  # Project description
  description: Mgmt

  # Allow manifests to deploy from any Git repos
  sourceRepos:
    - git@github.com:dsmillie-cts/sandbox-k8s.git

  # Only permit applications to deploy to the namespace
  destinations:
    - namespace: "*"
      server: https://kubernetes.default.svc
  # Deny all cluster-scoped resources from being created, except for Namespace
  clusterResourceWhitelist:
    - group: "*"
      kind: "*"
    - group: "rbac.authorization.k8s.io"
      kind: "*"

  # Enables namespace orphaned resource monitoring.
  orphanedResources:
    warn: false

  roles:
    # A role which provides read-only access to all applications in the project
    - name: mgmt-viewer
      description: Read-only privileges to mgmt
      policies:
        - p, proj:mgmt:read-only, applications, get, mgmt/*, allow
      groups:
        - viewer
